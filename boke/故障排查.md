# GitHub OAuth 404 错误排查

## 问题：点击 GitHub 登录出现 404 错误

## ⚠️ 最常见原因：GitHub OAuth App 回调 URL 配置错误

**404 错误通常是因为 GitHub OAuth App 中配置的回调 URL 与代码中的回调 URL 不匹配。**

## 快速修复步骤

### 步骤 1: 检查并修复 GitHub OAuth App 配置

1. **访问 GitHub OAuth App 设置页面**
   - 打开: https://github.com/settings/developers
   - 找到你的 OAuth App（或创建一个新的）

2. **检查回调 URL 配置**
   - 找到 "Authorization callback URL" 字段
   - **必须设置为**: `http://localhost:3001/api/auth/github/callback`
   - ⚠️ **注意**：必须完全匹配，包括：
     - 协议：`http://`（不是 `https://`）
     - 主机：`localhost`（不是 `127.0.0.1`）
     - 端口：`3001`（不是 `3000`）
     - 路径：`/api/auth/github/callback`

3. **保存配置**
   - 点击 "Update application" 保存更改

### 步骤 2: 检查环境变量配置

确保 `boke_server/.env` 文件存在并包含正确的配置：

```env
GITHUB_CLIENT_ID=你的GitHub_Client_ID
GITHUB_CLIENT_SECRET=你的GitHub_Client_Secret
```

### 步骤 3: 重启服务器

修改配置后，必须重启后端服务器：

```bash
# 停止当前服务器（Ctrl+C）
cd boke_server
npm start
```

### 步骤 4: 运行配置检查脚本

运行配置检查脚本来验证配置：

```bash
cd boke_server
node check-github-config.js
```

## 已修复的问题

✅ **Client ID 配置错误** - 已修复
- 之前：`GITHUB_CLIENT_ID` 和 `GITHUB_CLIENT_SECRET` 都填成了 Secret 的值
- 现在：已更正为正确的 Client ID

## 需要检查的配置

### 1. 重启后端服务器

修改 `.env` 后必须重启后端服务器才能生效：

```bash
# 停止当前服务器（Ctrl+C）
# 然后重新启动
cd boke_server
npm run dev
```

### 2. 检查 GitHub OAuth App 配置

访问 https://github.com/settings/developers，检查你的 OAuth App 配置：

**必须确保以下配置正确：**

1. **Application name**: TechBlo（或任意名称）
2. **Homepage URL**: `http://localhost:3000`
3. **Authorization callback URL**: `http://localhost:3001/api/auth/github/callback` ⚠️ **这很重要！**

**回调 URL 必须完全匹配：**
- ✅ 正确：`http://localhost:3001/api/auth/github/callback`
- ❌ 错误：`http://localhost:3000/api/auth/github/callback`
- ❌ 错误：`http://localhost:3001/github/callback`
- ❌ 错误：`https://github.com/...`

### 3. 验证 .env 文件配置

确保 `boke_server/.env` 文件包含：

```env
GITHUB_CLIENT_ID=Ov23liSYl2pLKUGt13uZ
GITHUB_CLIENT_SECRET=07502a9ea4374a969a4e8f37ebcf2eeb1c4e603b
```

### 4. 测试步骤

1. **确保后端服务器正在运行**（端口 3001）
   ```bash
   curl http://localhost:3001/api/health
   ```

2. **确保前端服务器正在运行**（端口 3000）
   ```bash
   # 访问 http://localhost:3000
   ```

3. **点击 GitHub 登录按钮**
   - 应该跳转到 GitHub 授权页面
   - 如果还是 404，检查浏览器控制台的错误信息

### 5. 常见错误原因

1. **回调 URL 配置错误** - 最常见的原因
   - GitHub OAuth App 的回调 URL 必须与代码中的 `callbackURL` 完全匹配
   - 检查 `boke_server/server.js` 第 88 行：`callbackURL: 'http://localhost:3001/api/auth/github/callback'`

2. **Client ID/Secret 错误**
   - 确保从 GitHub OAuth App 页面复制的值正确
   - 注意不要复制错误的值（Client ID 通常较短，Client Secret 较长）

3. **服务器未运行**
   - 确保后端服务器在端口 3001 运行
   - 确保前端服务器在端口 3000 运行

4. **环境变量未加载**
   - 修改 `.env` 后必须重启服务器
   - 检查服务器启动日志是否加载了环境变量

## 调试技巧

1. **查看后端服务器日志**
   - 启动服务器时会显示日志
   - 检查是否有错误信息

2. **查看浏览器控制台**
   - 打开开发者工具（F12）
   - 查看 Network 标签页，检查请求的 URL 和响应

3. **测试 GitHub OAuth 端点**
   ```bash
   # 直接访问 GitHub OAuth 端点
   curl http://localhost:3001/api/auth/github
   # 应该返回 302 重定向到 GitHub
   ```

4. **检查 GitHub OAuth App 状态**
   - 确保 OAuth App 是 "Active" 状态
   - 检查是否有任何限制或错误提示

